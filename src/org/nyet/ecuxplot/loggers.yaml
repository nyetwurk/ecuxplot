# Canonical unit standards - defines standard unit ONLY for special case exceptions
# Most units have inherent preference (PSI=US, mBar=Metric, etc.) and are handled automatically
# Format: column_name: "unit_string"
# Maps a canonical column alias to a single preferred unit (overrides global preference)
canonical_unit_standards:
  # Format: [["pattern", "unit"], ...]
  # Patterns are regex and matched in order, first match wins
  # Ambient pressure: Always mBar/kPa (never PSI, even in US Customary mode)
  - ["BaroPressure", "mBar"]

  # Add other special cases here as needed
  # Only list columns that have non-standard unit requirements
  # Do NOT list columns that follow normal unit preference rules

# Filter associations - canonical field names for common filter categories
filter_associations:
  # Note: These are single canonical field names, not arrays
  # All logger-specific field variations are aliased to these via loggers.yaml
  pedal: "AccelPedalPosition"
  throttle: "ThrottlePlateAngle"
  gear: "Gear"

# Global required columns - fundamental columns that should exist in all log formats
global_required_columns:
  - "RPM"
  - "TIME"

# Preset defaults - canonical column names for default axis presets
preset_defaults:
  # Note: These are canonical field names used in default presets
  # All presets should use these names to ensure consistency across log formats
  # Format: preset_name:
  #   xkey: "canonical_column_name"
  #   ykeys0: ["canonical_name1", "canonical_name2", ...]
  #   ykeys1: ["canonical_name1", "canonical_name2", ...]  # optional second Y-axis
  #   scatter: false  # optional scatter plot flag
  Power:
    xkey: "RPM"
    ykeys0: ["WHP", "WTQ", "HP", "TQ"]
    ykeys1: ["BoostPressureDesired (PSI)", "BoostPressureActual (PSI)"]
  Timing:
    xkey: "RPM"
    ykeys0: [EngineLoad, MassAirFlowPerStroke] # Not all ECUs are load based, they may only have MAF per stroke (COBB_AP)
    ykeys1: ["IgnitionTimingAngleOverall", "IgnitionTimingAngleOverallDesired"]
    scatter: true
  Fueling:
    xkey: "RPM"
    ykeys0: ["Zeitronix AFR", "Sim AFR"]
    ykeys1: ["Zeitronix Boost (PSI)", "BoostPressureDesired (PSI)", "BoostPressureActual (PSI)"]
  "Compressor Map":
    xkey: "Turbo Flow"
    ykeys0: ["BoostActual PR"]
  "Spool Rate":
    xkey: "BoostPressureActual (PSI)"
    ykeys0: ["Boost Spool Rate (RPM)"]
    ykeys1: ["Boost Spool Rate (time)"]

# Axis preset categories - reusable groups of columns for preset testing
axis_preset_categories:
  boost_both:
    - "BoostPressureDesired (PSI)"
    - "BoostPressureActual (PSI)"
  boost_actual:
    - "BoostPressureActual (PSI)"
  maf:
    - "MassAirFlow"
  timing_all:
    - "EngineLoad"
    - "IgnitionTimingAngleOverall"
    - "IgnitionTimingAngleOverallDesired"
  compressor_map_base:
    - "BaroPressure"

# Preset support profiles - reusable preset column expectations
preset_support_profiles:
  full_timing:
    Timing:
      - column: "RPM"  # xkey (global required, but explicit for clarity)
      - column: "IgnitionTimingAngleOverall"  # ykeys1
      - pattern: "IgnitionRetardCyl.*|AverageIgnitionRetard"  # for IgnitionTimingAngleOverallDesired calculation
  full_fueling:
    Fueling:
      - category: "boost_both"
      - category: "maf"
      - column: "EffInjectorDutyCycle"
      - column: "AirFuelRatioActual"
  partial_fueling:
    Fueling:
      - column: "AirFuelRatioActual"
  boost_presets:
    Power:
      - category: "boost_both"
    "Spool Rate":
      - category: "boost_actual"
  compressor_map:
    "Compressor Map":
      - category: "boost_actual"
      - category: "maf"
      - category: "compressor_map_base"

loggers:
  DEFAULT:
    # Extract field name and unit using regex
    unit_regex: "([\\S\\s]+)\\(([\\S\\s]+)\\)\\s*(.*)"

    # Note: .matches() requires entire string match, so ^ and $ are implicit
    # .* at start allows text before pattern, .* at end allows text after, overriding the implicit ^ and $
    aliases:
      - ["[Tt]ime", "TIME"]
      - ["[Ee]ngine RPM", "RPM"]
      - ["[Ee]ngine [Ss]peed", "RPM"]
      - ["[Mm]ass [Aa]ir [Ff]low.*", "MassAirFlow"]
      - ["Battery [Vv]oltage.*", "BatteryVoltage"]
      # We now assume the default IntakeAirTemperature is C
      - ["[Ii]ntake [Aa]ir [Tt]emperature", "IntakeAirTemperature"]
      - ["[Ee]ngine [Cc]oolant [Tt]emperature", "CoolantTemperature"]
      - ["[Cc]alculated [Ll]oad.*", "EngineLoad"]
      - ["[Aa]bsolute throttle.*position", "ThrottlePlateAngle"]
      # M-Tuner Logger mappings - no easy way to detect an M-Tuner logger, so we have to hardcode these in DEFAULT_aliases
      - ["Actual Ignition Angle", "IgnitionTimingAngleOverall"]
      - ["Ignition Angle Actual", "IgnitionTimingAngleOverall"]
      # Don't let ecuxplot change the lamda units to AFR, this column is always lambda
      #- ["Lambda Bank 1", "AirFuelRatioActual"]
      #- ["Lambda Bank 2", "AirFuelRatioActualBank2"]
      - ["Manifold Absolute Pressure", "BoostPressureActual"]
      - ["Manifold Pressure", "BoostPressureActual"]
      - ["Relative Load", "EngineLoad"]
      - ["Relative Load Setpoint", "EngineLoadDesired"]
      - ["Target Position Throttle", "ThrottlePlateAngle"]
      - ["Throttle Inlet Pressure", "ThrottleInletPressure"]
      - ["Vehicle [Ss]peed", "VehicleSpeed"]  # Matches "Vehicle Speed" and "Vehicle speed"
      # Additional M-Tuner cylinder-specific aliases
      - ["Cylinder 1 Ignition Retard", "IgnitionRetardCyl1"]
      - ["Cylinder 2 Ignition Retard", "IgnitionRetardCyl2"]
      - ["Cylinder 3 Ignition Retard", "IgnitionRetardCyl3"]
      - ["Cylinder 4 Ignition Retard", "IgnitionRetardCyl4"]
      - ["Cylinder 5 Ignition Retard", "IgnitionRetardCyl5"]
      - ["Cylinder 6 Ignition Retard", "IgnitionRetardCyl6"]

  ME7_ALIASES:
    # ME7L field name aliases loaded from me7_alias.map
    # These aliases are checked before DEFAULT for all loggers
    # These cannot be regex - we use a hash map for O(1) lookup
    aliases:
      # ME7_alias.map entries (201 aliases - inserted from file)
      - ["abo", "CountStartsWithOilInFuel"]
      - ["dlahi_w", "LambdaPID-I"]
      - ["dlahi2_w", "LambdaPID-I_Bank2"]
      - ["dlahp_w", "LambdaPID-P"]
      - ["dlahp2_w", "LambdaPID-P_Bank2"]
      - ["dmllri_w", "IdleSpeedPID-I"]
      - ["dwkrz_0", "IgnitionRetardCyl$1"]
      - ["dwkrz_1", "IgnitionRetardCyl$2"]
      - ["dwkrz_2", "IgnitionRetardCyl$3"]
      - ["dwkrz_3", "IgnitionRetardCyl$4"]
      - ["dwkrz_4", "IgnitionRetardCyl$5"]
      - ["dwkrz_5", "IgnitionRetardCyl$6"]
      - ["dwkrz_6", "IgnitionRetardCyl$7"]
      - ["dwkrz_7", "IgnitionRetardCyl$8"]
      - ["dynlsu_w", "DynamicFactorO2S"]
      - ["dynlsu2_w", "DynamicFactorO2SBank2"]
      - ["etazwbm", "EtaIgnitionAngleAvg"]
      - ["evz_austot", "Inj-Cut-Mask"]
      - ["fcmEnd", "NumberFaults"]
      # - ["fho", "AltitudeCorrectionFactor"] # 8-bit, skip
      - ["fho_w", "AltitudeCorrectionFactor"]
      - ["fr_w", "LambdaControl"]
      - ["fr2_w", "LambdaControlBank2"]
      - ["fra_w", "AdaptationPartial"]
      - ["fra2_w", "AdaptationPartialBank2"]
      - ["frm_w", "LambdaControlAvg"]
      - ["frm2_w", "LambdaControlAvgBank2"]
      - ["frxt", "LoadCorrectFactorCoolantTemp"]
      - ["frxta_w", "LoadCorrectFactorIntakeTemp"]
      - ["fzabg_w_0", "CountMisfireCyl_1"]
      - ["fzabg_w_1", "CountMisfireCyl_2"]
      - ["fzabg_w_2", "CountMisfireCyl_3"]
      - ["fzabg_w_3", "CountMisfireCyl_4"]
      - ["fzabg_w_4", "CountMisfireCyl_5"]
      - ["fzabg_w_5", "CountMisfireCyl_6"]
      - ["fzabg_w_6", "CountMisfireCyl_7"]
      - ["fzabg_w_7", "CountMisfireCyl_8"]
      - ["fzabg_w_8", "CountMisfireCyl_9"]
      - ["fzabg_w_9", "CountMisfireCyl_10"]
      - ["fzabg_w_10", "CountMisfireCyl_11"]
      - ["fzabg_w_11", "CountMisfireCyl_12"]
      - ["fzabgs_w", "CountMisfireTotal"]
      #- ["gangi", "SelectedGear"]  # me7_alias.map maps to SelectedGear
      - ["gangi", "Gear"] # Intentional deviation from me7_alias.map: our local convention uses "Gear" instead of "SelectedGear"
      - ["ksta0", "ColdStartEnrichmentRange0"]
      - ["ksta1", "ColdStartEnrichmentRange1"]
      - ["ksta2", "ColdStartEnrichmentRange2"]
      - ["lambts_w", "LambdaPartProtection"]
      - ["lamfa_w", "TargetAFRDriverRequest"]
      - ["lamsbg_w", "AirFuelRatioDesired"]
      - ["lamsbg2_w", "AirFuelRatioDesiredBank2"]
      - ["lamsoni_w", "AirFuelRatioActual"] # Intentional deviation from me7_alias.map: me7_alias.map maps to AirFuelRatioCurrent, we use AirFuelRatioActual for consistency
      - ["lamsoni2_w", "AirFuelRatioActualBank2"] # Intentional deviation from me7_alias.map: me7_alias.map maps to AirFuelRatioCurrentBank2, we use AirFuelRatioActualBank2 for consistency
      - ["lbz", "BatteryChargeBalance"]
      - ["ldimn_w", "BoostPID-I-Min"]
      - ["ldimx_w", "BoostPID-I-Max"]
      - ["ldimxa_0", "BoostCorrectFactorPID-IRange1"]
      - ["ldimxa_1", "BoostCorrectFactorPID-IRange2"]
      - ["ldimxa_2", "BoostCorrectFactorPID-IRange3"]
      - ["ldimxa_3", "BoostCorrectFactorPID-IRange4"]
      - ["ldimxa_4", "BoostCorrectFactorPID-IRange5"]
      - ["ldimxak_w", "ChargeLimitPID-I"]
      - ["lditv_w", "BoostPID-I-Result"]
      - ["ldptv", "BoostPID-P-Result"]
      - ["ldrdtv", "BoostPID-D-Result"]
      - ["ldrlms_w", "ChargeLimitEngineProtection"]
      - ["ldrlts_w", "ChargeLimitTurboProtection"]
      - ["ldtv", "WastegateDutyCycleAfterLin"]
      - ["ldtvm", "WastegateDutyCycle"]
      - ["ldtvr_w", "WastegateDutyCycleBeforeLin"]
      - ["mdverl_w", "EngineLossTorque"]
      - ["miasrl_w", "RequestedTorqueTractionControl"]
      - ["mifa_w", "TorqueDesired"]
      - ["miszul_w", "TorqueForTimingInterventionLimit"]
      - ["mrfa_w", "DriverRequestedRelTorque"]
      - ["msdk_w", "MassAirFlowAtThrottlePlate"]
      - ["mshfm_w", "MassAirFlow"]
      # - ["nmot", "EngineSpeed"] # 8-bit, skip
      # - ["nmot_w", "EngineSpeed"]  # me7_alias.map maps to EngineSpeed
      - ["nmot_w", "RPM"] # Intentional deviation from me7_alias.map: our local convention uses "RPM" instead of "EngineSpeed"
      - ["nmotll", "EngineIdlingSpeed"]
      - ["nsol", "RequestedEngineIdlingSpeed"]
      - ["perffilt_w", "CPU-Load"]
      - ["perfmax_w", "MAX-Load"]
      # - ["plsol", "BoostPressureDesired"] # 8-bit, skip
      - ["plsol_w", "BoostPressureDesired"]
      # - ["pu", "BaroPressure"] # 8-bit, skip
      - ["pu_w", "BaroPressure"]
      - ["pus_w", "BaroPressure"]
      - ["pvdkds_w", "BoostPressureActual"]
      - ["pvdks_w", "BoostPressureActual"]
      - ["ready", "ReadynessByte"]
      - ["redist", "Inj-Reduction"]
      - ["rinh_w", "ResistanceSensor2"]
      - ["rinh2_w", "ResistanceSensor2Bank2"]
      - ["rinv_w", "ResistanceSensor1"]
      - ["rinv2_w", "ResistanceSensor1Bank2"]
      - ["rkat_w", "AdaptationIdle"]
      - ["rkat2_w", "AdaptationIdleBank2"]
      - ["rkrn_w_0", "KnockVoltageCyl_1"]
      - ["rkrn_w_1", "KnockVoltageCyl_2"]
      - ["rkrn_w_2", "KnockVoltageCyl_3"]
      - ["rkrn_w_3", "KnockVoltageCyl_4"]
      - ["rkrn_w_4", "KnockVoltageCyl_5"]
      - ["rkrn_w_5", "KnockVoltageCyl_6"]
      - ["rkrn_w_6", "KnockVoltageCyl_7"]
      - ["rkrn_w_7", "KnockVoltageCyl_8"]
      # - ["rl", "EngineLoad_8"] # 8-bit, skip
      - ["rl_w", "EngineLoad"]
      - ["rlmax_w", "EngineLoadCorrected"]
      - ["rlmx_w", "EngineLoadSpecified"]
      - ["rlsol_w", "EngineLoadRequested"]
      - ["rmslt", "SecondaryAirMass"]
      - ["rmslt2", "SecondaryAirMassBank2"]
      - ["tabgbts_w", "EGTForPartPro"]
      - ["tabgm", "EGTModelBeforeCat8"] # 8-bit, seen in Winlog
      - ["tabgm_w", "EGTModelBeforeCat"]
      - ["tabgm2", "EGTModelBeforeCatBank2"]
      - ["talsuf", "EGTModelFiltered"]
      - ["tans", "IntakeAirTemperature"]
      - ["tanslin", "IntakeAirTemperatureAfterLin"]
      - ["tateout", "ACFValveDutyCycle"]
      - ["tats_w", "EGTSensor"]
      - ["tats2_w", "EGTSensorBank2"]
      - ["tavvkm_w", "EGTModelBeforePreCat"]
      - ["te_w", "EffInjectionTime"]
      - ["te2_w", "EffInjectionTimeBank2"]
      - ["ti_avg", "FuelInjectorOnTimeAverage"]
      - ["ti_b1", "FuelInjectorOnTime"]
      - ["ti_b2", "FuelInjectorOnTimeBank2"]
      - ["tikatm_w", "EGTModelInCat"]
      - ["timx_w", "MaxInjectionTime"]
      - ["timxth_w", "TheorMaxInjectionTime"]
      - ["tkatm", "CatTemperatureModel"]
      - ["tkatm2", "CatTemperatureModelBank2"]
      - ["tkihkm_w", "MainCatTemperatureModel"]
      - ["tmot", "CoolantTemperature"]
      - ["tmotlin", "CoolantTemperatureAfterLin"]
      - ["tmotsoll", "CoolantTemperatureRequested"]
      - ["tmst", "EngineStartTemperature"]
      - ["tnst_w", "TimeSinceStart"]
      - ["ub", "BatteryVoltage"]
      - ["udknlp1r", "EmergencyAirGapSensorG187"]
      - ["udknlp2r", "EmergencyAirGapSensorG188"]
      - ["udkp1_w", "ThrottlePlateSensorG187"]
      - ["udkp2_w", "ThrottlePlateSensorG188"]
      - ["udkp1asr_w", "LowerValueSensorG187"]
      - ["udkp2asr_w", "LowerValueSensorG188"]
      - ["uhfm_w", "MAFSensorVoltage"]
      - ["upwg1_w", "AccelPedalSensorG79"]
      - ["upwg2_w", "AccelPedalSensorG185"]
      - ["ushk", "O2SVoltageSensor2"]
      - ["ushk2", "O2SVoltageSensor2Bank2"]
      - ["usvk", "O2SVoltageSensor1"]
      - ["usvk2", "O2SVoltageSensor1Bank2"]
      - ["uulsuv_w", "O2SVoltageWideband"]
      - ["uulsuv2_w", "O2SVoltageWidebandBank2"]
      - ["vfil_w", "VehicleSpeed"]
      - ["vfzg", "VehicleSpeed"]
      - ["vfzroh_w", "VehicleSpeed"]
      - ["vziel_w", "TargetSpeedCruiseControl"]
      - ["wdkba", "ThrottlePlateAngle"]
      - ["wdks", "ThrottlePlateAngleRequested"]
      # Intentional deviation from me7_alias.map: wkr_* maps to IgnRetardKnockControlCyl_* in me7_alias.map,
      # but we map directly to IgnitionRetardCyl* because the calculation code (ECUxDataset.java) expects IgnitionRetardCyl* fields
      - ["wkr_0", "IgnitionRetardCyl1"]
      - ["wkr_1", "IgnitionRetardCyl2"]
      - ["wkr_2", "IgnitionRetardCyl3"]
      - ["wkr_3", "IgnitionRetardCyl4"]
      - ["wkr_4", "IgnitionRetardCyl5"]
      - ["wkr_5", "IgnitionRetardCyl6"]
      - ["wkr_6", "IgnitionRetardCyl7"]
      - ["wkr_7", "IgnitionRetardCyl8"]
      - ["wkrdya_0", "AdaptedIgnitionAngleDynRange1"]
      - ["wkrdya_1", "AdaptedIgnitionAngleDynRange2"]
      - ["wkrdya_2", "AdaptedIgnitionAngleDynRange3"]
      - ["wkrdya_3", "AdaptedIgnitionAngleDynRange4"]
      - ["wkrdya_4", "AdaptedIgnitionAngleDynRange5"]
      - ["wkrm", "AvgIgnitionRetardKnockControl"]
      - ["wkrma", "AvgIgnitionRetardKnockControl"]
      - ["wnwi_w", "CamshaftAngle"]
      - ["wnwi2_w", "CamshaftAngleBank2"]
      - ["wnwisa_w", "OutletCamshaftAngle"]
      - ["wnwise_w", "IntakeCamshaftAngle"]
      - ["wnwis2a_w", "OutletCamshaftAngleBank2"]
      - ["wnwis2e_w", "IntakeCamshaftAngleBank2"]
      # - ["wped", "AccelPedalPosition"] # 8-bit, skip
      - ["wped_w", "AccelPedalPosition"]
      - ["wub", "BatteryVoltage"]
      - ["wubr", "SupplyVoltage"]
      - ["zwist", "IgnitionTimingAngle"]
      - ["zwout", "IgnitionTimingAngleOverall"]
      - ["B_bl", "CondBrakeLightSwitch"]
      - ["B_br", "CondBrakePedalSwitch"]
      - ["B_kuppl", "CondClutchPedalSwitch"]
      - ["B_lambts", "CondLambdaPartProtectionActive"]
      - ["B_ldob", "CondOverboostActive"]
      - ["B_ldobsp", "CondOverboostDuringBlockPeriod"]
      - ["B_sa", "CondFuelCutoff"]
      - ["B_tabgbts", "CondEGTForPartProtection"]
      - ["B_tal", "CondFuelTankEmpty"]
      - ["S_fgrat", "SwitchOffTipCruiseControl"]
      - ["S_fgrhs", "MainSwitchCruiseControl"]
      - ["S_fgrsv", "TipSetDecCruiseControl"]
      - ["S_fgrwb", "TipResetAccCruiseControl"]

  COBB_AP:
    field_signatures:
      - regex: "AP Info:.*"

    # Extract field name and unit using regex
    unit_regex: "([\\S\\s]+)\\(([\\S\\s]+)\\)\\s*(.*)"

    aliases:
      - ["AP Info:.*", ""]
      - ["Time.*", "TIME"]
      - ["Engine Speed.*", "RPM"]
      - ["Current Gear.*", "Gear"]
      - ["Accel Pedal Position.*", "AccelPedalPosition"]
      - ["TPS.*", "ThrottlePlateAngle"]
      - ["AFR Set Point.*", "AirFuelRatioDesired (AFR)"] # workaround for ME7L's AFR alias
      - ["AFR.*", "AirFuelRatioActual"]
      - ["Trgt\\. Boost Press\\..*", "BoostPressureDesired"]
      - ["Boost.*", "BoostPressureActual"] # Sometimes Boost Press. (psi), sometimes Boost (psi)
      #- ["Boost Press\\..*", "BoostPressureActual"]
      - ["Air Mass IM Per Stroke.*", "MassAirFlowPerStroke"]
      - ["Air Mass Per Stroke SP.*", "MassAirFlowPerStrokeDesired"]
      - ["Ambient Air Temp\\..*", "AmbientTemperature"]
      - ["Coolant Temp\\..*", "WaterTemperature"]
      - ["Engine Oil Temp\\..*", "OilTemperature"]
      - ["IAT.*", "IntakeAirTemperature"]
      - ["Ignition Timing Final.*", "IgnitionTimingAngleOverall"]
      - ["Knock Retard Cylinder 1.*", "IgnitionRetardCyl1"]
      - ["Knock Retard Cylinder 2.*", "IgnitionRetardCyl2"]
      - ["Knock Retard Cylinder 3.*", "IgnitionRetardCyl3"]
      - ["Knock Retard Cylinder 4.*", "IgnitionRetardCyl4"]
      - ["Knock Retard Cylinder 5.*", "IgnitionRetardCyl5"]
      - ["Knock Retard Cylinder 6.*", "IgnitionRetardCyl6"]
      - ["Knock Retard Cylinder 7.*", "IgnitionRetardCyl7"]
      - ["Knock Retard Cylinder 8.*", "IgnitionRetardCyl8"]
      - ["Turbine Act\\. Base Value.*", "WastegateDutyCycleBase"]
      - ["Turbine Act\\. Final Value.*", "WastegateDutyCycle"]
      - ["Vehicle Speed.*", "VehicleSpeed"]

  ECUX:
    field_signatures:
      - regex: "TIME"
        column_index: 0
    time_ticks_per_sec: 1000

    aliases:
      - ["AcceleratorPedalPosition", "AccelPedalPosition"]
      - ["BstActual", "BoostPressureActual"]
      - ["BstDesired", "BoostPressureDesired"]

  EVOSCAN:
    field_signatures:
      - regex: "LogID"
    aliases:
      - [".*RPM$", "RPM"]
      - ["LogEntrySeconds", "TIME"]
      - ["TPS", "ThrottlePlateAngle"]
      - ["APP", "AccelPedalPosition"]
      - ["IAT", "IntakeAirTemperature"]

  JB4:
    field_signatures:
      - regex: "Firmware"
    # Skip 4 lines: 1) Settings names, 2) Settings values, 3) More settings names, 4) More settings values
    time_ticks_per_sec: 10
    skip_lines: 4

    # Note that we alias to the canonical name with the unit in parentheses for unit extraction to override the units
    aliases:
      - ["timestamp", "TIME"]
      - ["rpm", "RPM"]
      - ["pedal", "AccelPedalPosition"]  # Use ME7 canonical name, Units.java has %
      - ["mph", "VehicleSpeed (mph)"]  # JB4 uses mph, ME7 uses kph
      - ["throttle", "ThrottlePlateAngle"]
      - ["ecu_psi", "ECUBoostPressureActual (PSI)"]  # JB4 uses PSI, ME7 uses mBar
      - ["dme_bt", "BoostPressureDesiredDelta (PSI)"]  # JB4 uses PSI, ME7 uses mBar
      - ["target", "BoostPressureDesired (PSI)"]  # JB4 uses PSI, ME7 uses mBar
      - ["boost", "BoostPressureActual (PSI)"]  # JB4 uses PSI, ME7 uses mBar
      - ["boost2", "BoostPressureActual2 (PSI)"]  # JB4 uses PSI, ME7 uses mBar
      - ["ff", "BoostFeedForward"]
      - ["map", "SelectedMap"]
      - ["wgdc", "WastegateDutyCycle"]
      - ["iat", "IntakeAirTemperature (°F)"]  # JB4 uses °F, ME7 uses °C
      - ["fp_h", "FuelPressureHigh (PSI)"]  # JB4 uses PSI, ME7 uses mBar
      - ["fp_l", "FuelPressureLow (PSI)"]  # JB4 uses PSI, ME7 uses mBar
      - ["waterf", "WaterTemperature (°F)"]  # JB4 uses °F, ME7 uses °C
      - ["oilf", "OilTemperature (°F)"]  # JB4 uses °F, ME7 uses °C
      - ["transf", "TransmissionTemperature (°F)"]  # JB4 uses °F, ME7 uses °C
      - ["gear", "Gear"]
      - ["load", "EngineLoad"]
      - ["calc_torque", "CalculatedTorque"]
      - ["afr", "AirFuelRatio"]
      - ["afr2", "AirFuelRatio2"]
      - ["trims", "FuelTrim (%)"]  # JB4 uses %, ME7 uses %
      - ["trims2", "FuelTrim2 (%)"]  # JB4 uses %, ME7 uses %
      - ["fuelen", "FuelEnrichment (%)"]  # JB4 uses %, ME7 uses %
      - ["meth", "MethanolFlow (%)"]  # JB4 uses %, ME7 uses %
      - ["e85", "E85"]
      - ["avg_ign", "AverageIgnitionRetard"]
      - ["ign_1", "IgnitionTimingAngle1"]
      - ["ign_2", "IgnitionTimingAngle2"]
      - ["ign_3", "IgnitionTimingAngle3"]
      - ["ign_4", "IgnitionTimingAngle4"]
      - ["ign_5", "IgnitionTimingAngle5"]
      - ["ign_6", "IgnitionTimingAngle6"]
      - ["ign_7", "IgnitionTimingAngle7"]
      - ["ign_8", "IgnitionTimingAngle8"]

  LOGWORKS:
    field_signatures:
      - regex: "Session: Session [0-8]+"
    # Skip 1 line: Session header to get to actual data header
    skip_lines: 1
    header_format: "id,u"
    aliases:
      - ["time", "TIME"]
      - ["Boost", "BoostPressureActual"]
      - ["LC1_O2WB", "AirFuelRatioActual"]  # Use ME7 modified canonical name, Units.java has AFR pattern

  OBDLINK:
    comment_signatures:
      - regex: ".*StartTime.*"
    # Match pattern: "field (desc) (unit)" or "field (unit)"
    # Use greedy match to capture everything up to last parentheses
    # This preserves bank/sensor info in field name for alias matching
    # Group 1 = field name (with desc if present), Group 2 = unit (from last paren)
    unit_regex: "^(.+)\\s+\\(([^)]+)\\)$"
    aliases:
      # OBD-II scan tool specific field patterns
      - ["[Ss]hort term fuel.*trim.*[Bb]ank 1", "STFT"]
      - ["[Ss]hort term fuel.*trim.*[Bb]ank 2", "STFTBank2"]
      - ["[Ll]ong term fuel.*trim.*[Bb]ank 1", "LTFT"]
      - ["[Ll]ong term fuel.*trim.*[Bb]ank 2", "LTFTBank2"]
      - ["[Ii]gnition timing.*advance.*1.*", "IgnitionRetardCyl1"]
      - ["[Ii]gnition timing.*advance.*2.*", "IgnitionRetardCyl2"]
      - ["[Ii]gnition timing.*advance.*3.*", "IgnitionRetardCyl3"]
      - ["[Ii]gnition timing.*advance.*4.*", "IgnitionRetardCyl4"]
      - ["[Ii]gnition timing.*advance.*5.*", "IgnitionRetardCyl5"]
      - ["[Ii]gnition timing.*advance.*6.*", "IgnitionRetardCyl6"]
      - ["[Ii]gnition timing.*advance.*7.*", "IgnitionRetardCyl7"]
      - ["[Ii]gnition timing.*advance.*8.*", "IgnitionRetardCyl8"]
      - [".*[Oo]2 voltage.*[Bb]ank 1.*[Ss]ensor 1.*", "O2SVoltageSensor1"]
      - [".*[Oo]2 voltage.*[Bb]ank 1.*[Ss]ensor 2.*", "O2SVoltageSensor2"]
      - [".*[Oo]2 voltage.*[Bb]ank 2.*[Ss]ensor 1.*", "O2SVoltageSensor1Bank2"]
      - [".*[Oo]2 voltage.*[Bb]ank 2.*[Ss]ensor 2.*", "O2SVoltageSensor2Bank2"]
      - [".*[Oo]2 sensor lambda.*[Bb]ank 1.*", "LambdaActual"]
      - [".*[Oo]2 sensor lambda.*[Bb]ank 2.*", "LambdaActualBank2"]
      - ["[Ii]nput voltage.*scan tool", "BatteryVoltage"]
      - ["Commanded secondary air status", "SecondaryAirStatusDesired"]

  ME7LOGGER:
    field_signatures:
      - regex: ".*ME7-Logger.*"

    skip_lines: 20 # maximum lines to skip with skip_regex
    # Dynamic header finding using regex patterns (more robust than fixed skip_lines)
    skip_regex:
      - regex: "TimeStamp"
        column: 0

    # Extract field name and unit using regex if there
    unit_regex: "([\\S\\s]+)\\(([\\S\\s]+)\\)\\s*(.*)"

    # Header structure configuration (Level 1 - ready for implementation)
    header_format: "id_orig,u,id"  # ME7LOGGER: raw names, units, canonical names (3 header lines)

    # Conditional prepend for empty field names
    field_transformations:
      prepend: "ME7L "
      if_empty: true

    aliases:
      - ["Engine[Ss]peed", "RPM"]
      - [".*Gear", "Gear"]
      - ["BoostPressureSpecified", "BoostPressureDesired"]
      - ["EngineLoadCorrectedSpecified", "EngineLoadCorrected"]
      - ["AtmosphericPressure", "BaroPressure"]
      - ["AirFuelRatioRequired", "AirFuelRatioDesired"]
      - ["InjectionTime", "EffInjectionTime"]
      - ["InjectionTimeBank2", "EffInjectionTimeBank2"]

  SIMOS_TOOLS:
    field_signatures:
      - regex: ".*SimosTools.*"

    # Extract field name and unit using regex
    unit_regex: "([\\S\\s]+)\\(([\\S\\s]+)\\)\\s*(.*)"

    aliases:
      - ["Time.*", "TIME"]
      #- ["Accel Long.*", "AccelerationLongitudinal"]
      - ["AFR SP.*", "AirFuelRatioDesired"]
      - ["AFR.*", "AirFuelRatioActual"]
      - ["Airmass SP.*", "MAFDesired"]
      - ["Airmass.*", "MassAirFlow"]
      - ["Ambient Press.*", "BaroPressure"]
      - ["Ambient Temp.*", "AmbientTemperature"]
      - ["Battery Volts.*", "BatteryVoltage"]
      - ["Boost.*", "BoostPressure"] # usually "Boost (psi)" - no Actual so it is not confused with MAP (kPa)
      - ["Comb Mode.*", "CombustionMode"]
      - ["Coolant Temp.*", "CoolantTemperature"]
      - ["Current Gear.*", "Gear"]
      - ["DV Position.*", "DiverterValvePosition"]
      - ["Engine Speed.*", "RPM"]
      - ["EOI Actual.*", "EndOfInjectionActual"]
      - ["EOI Limit.*", "EndOfInjectionLimit"]
      - ["Eth Content.*", "EthanolContent"]
      - ["Exhaust Cam.*", "ExhaustCamPosition"]
      - ["Exh Flow Factor.*", "ExhaustFlowFactor"]
      - ["Ext Press Des.*", "ExternalPressureDesired"]
      - ["FP DI SP.*", "FuelPressure DI Desired"]
      - ["FP DI.*", "FuelPressure DI"]
      - ["FP MPI SP.*", "FuelPressure MPI Desired"]
      - ["FP MPI.*", "FuelPressure MPI"]
      - ["Fuel Flow SP.*", "FuelFlowDesired"]
      - ["Fuel Flow.*", "FuelFlow"]
      #- ["Fuel Split MPI.*", "FuelSplitMultiPortInjection"]
      - ["HPFP Eff Vol.*", "Fuel HPFP Eff Volume"]
      - ["IAT.*", "IntakeAirTemperature"]
      - ["Ign Table Value.*", "IgnitionTableValue"]
      - ["Ign Timing Avg.*", "IgnitionTimingAngleOverall"]
      - ["Inj PW DI.*", "FuelInj PW DI"]
      - ["Inj PW MPI.*", "FuelInj PW MPI"]
      #- ["Intake Cam.*", "IntakeCamPosition"]
      #- ["Intake Flow Fact.*", "IntakeFlowFactor"]
      - ["Knock Cyl 1.*", "IgnitionRetardCyl1"]
      - ["Knock Cyl 2.*", "IgnitionRetardCyl2"]
      - ["Knock Cyl 3.*", "IgnitionRetardCyl3"]
      - ["Knock Cyl 4.*", "IgnitionRetardCyl4"]
      - ["Lambda SP.*", "LambdaDesired"]
      - ["Lambda.*", "LambdaActual"]
      - ["LPFP DC.*", "Fuel LPFP DC"]
      - ["LTFT.*", "LTFT"]
      - ["MAP SP.*", "BoostPressureDesired"] # usually "MAP SP (kPa)"
      - ["MAP.*", "BoostPressureActual"] # usually "MAP (kPa)"
      #- ["Misfire Cyl 1.*", "MisfireCyl1"]
      #- ["Misfire Cyl 2.*", "MisfireCyl2"]
      #- ["Misfire Cyl 3.*", "MisfireCyl3"]
      #- ["Misfire Cyl 4.*", "MisfireCyl4"]
      - ["OF Ign Cor.*", "OptimumFillingIgnitionCorrection"]
      - ["OF Ign Fac.*", "OptimumFillingIgnitionFactor"]
      - ["OF Ign Max.*", "OptimumFillingIgnitionMax"]
      - ["OF Tq Mult.*", "OptimumFillingTorqueMultiplier"]
      - ["Oil Temp.*", "OilTemperature"]
      - ["Pedal Pos.*", "AccelPedalPosition"]
      #- ["Port Flap Pos.*", "PortFlapPosition"]
      - ["PUT SP.*", "BoostPressure UT Desired"]
      - ["PUT.*", "BoostPressure UT"]
      - ["SOI Actual.*", "Fuel SOI Actual"]
      - ["SOI Limit.*", "Fuel SOI Limit"]
      - ["STFT.*", "STFT"]
      - ["Torque Lim.*", "TorqueLimit"]
      - ["Torque Req.*", "TorqueRequested"]
      - ["Torque.*", "TorqueActual"]
      - ["TPS.*", "ThrottlePlateAngle"]
      - ["Trans Temp.*", "TransmissionTemperature"]
      #- ["Valve Lift Pos.*", "ValveLiftPosition"]
      - ["Vehicle Speed.*", "VehicleSpeed"]
      - ["WG Flow Des.*", "WastegateFlowDesired"]
      - ["WG Pos Base.*", "WastegatePositionBase"]
      - ["WG Pos Final.*", "WastegateDutyCycle"]
      - ["WG I Value.*", "BoostPID-I-Result"]
      - ["WG P-D Value.*", "BoostPID-P-Result"]
      - ["WG [Vv]oltage.*", "WastegateVoltage"]
      - ["Wheel Speed FL.*", "WheelSpeedFrontLeft"]
      - ["Wheel Speed FR.*", "WheelSpeedFrontRight"]
      - ["knks_rng_h 1.*", "KnockSensorRangeHigh1"]
      - ["knks_rng_h 2.*", "KnockSensorRangeHigh2"]
      - ["knks_rng_h 3.*", "KnockSensorRangeHigh3"]
      - ["knks_rng_h 4.*", "KnockSensorRangeHigh4"]
      - ["knks_rng_h 5.*", "KnockSensorRangeHigh5"]
      - ["knks_rng_h 6.*", "KnockSensorRangeHigh6"]
      - ["knks_rng_h 7.*", "KnockSensorRangeHigh7"]
      - ["knks_rng_h 8.*", "KnockSensorRangeHigh8"]
      - ["knks_thd 1.*", "KnockSensorThreshold1"]
      - ["knks_thd 2.*", "KnockSensorThreshold2"]
      - ["knks_thd 3.*", "KnockSensorThreshold3"]
      - ["knks_thd 4.*", "KnockSensorThreshold4"]
      - ["knks_thd 5.*", "KnockSensorThreshold5"]
      - ["knks_thd 6.*", "KnockSensorThreshold6"]
      - ["knks_thd 7.*", "KnockSensorThreshold7"]
      - ["knks_thd 8.*", "KnockSensorThreshold8"]
      - ["nl 1.*", "KnockNoiseLevel1"]
      - ["nl 2.*", "KnockNoiseLevel2"]
      - ["nl 3.*", "KnockNoiseLevel3"]
      - ["nl 4.*", "KnockNoiseLevel4"]
      - ["nl 5.*", "KnockNoiseLevel5"]
      - ["nl 6.*", "KnockNoiseLevel6"]
      - ["nl 7.*", "KnockNoiseLevel7"]
      - ["nl 8.*", "KnockNoiseLevel8"]
      - ["SimosTools.*", ""] # blacklist

  SWCOMM:
    comment_signatures:
      - regex: ".*SWComm.*ECUTools.*"
    # Header structure configuration (Level 1 - ready for implementation)
    header_format: "id,u"  # SWCOMM: field names, units (2 header lines, skip aliases line)
    aliases:
      - ["TimeStamp", "TIME"]
      - ["N", "RPM"]
      - ["TIA", "IntakeAirTemperature"]
      - ["TCO", "CoolantTemperature"]
      - ["TOIL", "OilTemperature"]
      - ["Ambient air temperature", "AmbientTemperature"]
      - ["AMP", "BaroPressure"]
      - ["MAP", "BoostPressure"]
      - ["MAP_MES", "BoostPressureActual"]
      - ["MAP_SP", "BoostPressureDesired"]
      - ["FUP", "FuelPressureHigh"]
      - ["FUP_SP", "FuelPressureHighDesired"]
      - ["FUP_EFP", "FuelPressureHighEFP"]
      - ["RFP_AV", "RailPressureActual"]
      - ["MAF_THR", "MassAirFlowAtThrottle"]
      - ["MAF", "MassAirFlow"]
      - ["PV_AV", "AccelPedalPosition"]
      - ["TPS_AV", "ThrottlePlateAngle"]
      - ["TQI_AV", "TorqueActual"]
      - ["IGA_AV_MV", "IgnitionTimingAngleOverall"]
      - ['IGA_IGC\\[0\\]', "IgnitionTimingAngle1"]
      - ['IGA_IGC\\[4\\]', "IgnitionTimingAngle5"]
      - ['IGA_ADJ_KNK\\[0\\]', "IgnitionRetardCyl1"]
      - ['IGA_ADJ_KNK\\[3\\]', "IgnitionRetardCyl4"]
      - ['IGA_ADJ_KNK\\[5\\]', "IgnitionRetardCyl6"]
      - ['TI_1_HOM\\[0\\]', "FuelInjectorOnTime1"]
      - ['TI_1_HOM\\[2\\]', "FuelInjectorOnTime2"]
      - ['LAMB_LS_UP\\[1\\]', "O2SVoltageSensor1"]
      - ['LAMB_LS_UP\\[2\\]', "O2SVoltageSensor1Bank2"]
      - ['LAMB_SP\\[1\\]', "AirFuelRatioDesired"]
      - ['LAMB_SP\\[2\\]', "AirFuelRatioDesired2"]
      - ["STFT Bank 1", "STFT"]
      - ["LTFT Bank 1", "LTFT"]
      - ["STFT Bank 2", "STFTBank2"]
      - ["LTFT Bank 2", "LTFTBank2"]
      - ["GEAR", "Gear"]
      - ["VS", "VehicleSpeed"]
      - ['CAM_PHA\\[IN\\]\\[1\\]', "IntakeCamPosition"]
      - ["PWM_CWP_2", "WastegateDutyCycle"]
      - ["EFPPWM", "WastegateDutyCycle2"]
      - ["FAC_LAM_CP", "LambdaControl"]

  VCDS_LEGACY:
    field_signatures:
      - regex: ".*(Group|Block) [A-Z]:.*"  # Format 1: Group A:, Group B: markers (alphabetic)

    skip_lines: 10
    skip_regex:
      - regex: ".*(Group|Block) [A-Z]:.*"  # Format 1: Group A:, Group B: markers (separate line)
      - regex: "G[0-9]+"

    header_format: "g,id,id2,u"
    aliases_from: "VCDS"

  VCDS:
    field_signatures:
      - regex: ".*Group \\d+.*"  # Format 2: Group 23, Group 23 - Field 0 (numeric groups only)
      - regex: ".*Loc\\. IDE\\d+.*"

    skip_lines: 10
    skip_regex:
      - regex: ".*Group \\d+ - Field.*"  # Format 2: Group 23 - Field 0 (in field names)
      - regex: ".*Loc\\. IDE\\d+.*"

    header_format: "g,id,u"

    # Proposed field transformations (Level 2 - may be needed later)
    # field_transformations:
    #   append: " [024]"       # VCDS adds group suffix to some fields
    #   disambiguation: "2 [024]" # before group suffix

    aliases:
      - ["(STAMP|MARKE|Zeit)", "TIME"]
      - ["Absolute Pres.", "BoostPressure"]
      - ["Charge pressure control; charge press\\.before throttle valve", "BoostPressureRelative (mBar[gauge])"]  # Unit in parentheses with [gauge] modifier
      - ["Accelerator [Pp]osition", "AccelPedalPosition"]
      - ["Boost Pressure \\(actual\\)", "BoostPressureActual"]
      - ["Boost Pressure \\(specified\\)", "BoostPressureDesired"]
      - ["Duty Cycle", "WastegateDutyCycle"]
      - ["[Ww]astegate .*Duty Cycle", "WastegateDutyCycle"]
      - ["Engine speed; actual", "RPMActual"]
      - ["Engine speed; specified", "RPMSpecified"]
      - ["(Engine RPM|Engine [ -]*[Ss]peed|Motordrehzahl).*", "RPM"]
      - ["Engine .*Corrected .*Load", "EngineLoadCorrected"]
      - ["Engine .*Specified .*Load", "EngineLoadSpecified"]
      - ["(Engine .*[Ll]oad|Load)", "EngineLoad"]
      - ["Fuel Injector(.*) Time", "FuelInjectorOnTime"]
      - ["Idle (RPM|[Ss]peed).*", "Idle RPM"]
      - ["Ign.*[Tt]iming.*", "IgnitionTimingAngleOverall"]
      - ["Inj\\. On Time.*", "FuelInjectorOnTime"]
      - ["Knock Reg\\.", "IgnitionRetard"]
      - ["Air .*Mass Flow", "MassAirFlow"]
      - ["Mass [Aa]ir [Ff]low.*", "MassAirFlow"]
      - ["Mass [Aa]ir [Tt]aken [Ii]n.*", "MassAirFlow"]
      - ["Mass Flow", "MassAirFlow"]
      - ["T\\.B\\. Angle", "ThrottlePlateAngle"]
      - ["Throttle .*Angle", "ThrottlePlateAngle"]
      # Use .* at end to allow additional characters after the pattern
      - ["Throttle [Aa]ngle.*", "ThrottlePlateAngle"]
      - ["Throttle [Vv]alve [Aa]ngle.*", "ThrottlePlateAngle"]
      - ["Vehicle speed; filtered", "VehicleSpeedFiltered"]
      - ["Vehicle speed.*", "VehicleSpeed"]
      - ["Engine torque", "TorqueActual"]
      # German VCDS field name aliases
      - ["angesaugte.*", "MassAirFlow"]
      - ["Abgastemperatursensor 1", "EGTSensor1"]
      - ["Abgastemperatursensor 2", "EGTSensor2"]
      - ["Abgastemperatursensor 3", "EGTSensor3"]
      - ["Abgastemperatursensor 4", "EGTSensor4"]
      - ["Einspritzzeit", "FuelInjectorOnTime"]
      - ["Einspritzzeit.*\\(korrigiert\\)", "FuelInjectorOnTimeCorrected"]
      - ["Ladedruck: Sollwert", "BoostPressureDesired"]
      - ["Ladedruck: Istwert", "BoostPressureActual"]
      - ["Lambda.*Korrekturfaktor", "LambdaCorrectionFactor"]
      - ["Lambda.*Regler", "LambdaControl"]
      - ["Lambdasonden-[Ss]pannung", "O2SVoltageSensor"] # spannung = voltage
      - ["Lambdasonden-.*", "LambdaActual"] # sonden = sensor
      - ["Luftmasse: Istwert", "MassAirFlow"]
      - ["Motorlast", "EngineLoad"] # last == load
      - ["Tastverh.ltnis.*", "WastegateDutyCycle"] # tastverhältnis == duty cycle

  VOLVOLOGGER:
    comment_signatures:
      - regex: ".*VolvoTools.*"
      - regex: ".*VOLVO logger.*"

    # Extract field name and unit using regex
    unit_regex: "([\\S\\s]+)\\(([\\S\\s]+)\\)\\s*(.*)"

    aliases:
      - ["Time", "TIME"]
      - ["Engine Speed.*", "RPM"]
      - ["Boost Pressure.*", "BoostPressureActual"]
      - ["Throttle Pos.*", "ThrottlePlateAngle"]
      - ["Vehicle Speed.*", "VehicleSpeed"]

  ZEITRONIX:
    # This will not work for files without headers, but user can always force zeitronix logger type
    field_signatures:
      - regex: ".*Zeitronix.*"  # Filename line contains "Zeitronix"
      - regex: "Date Exported:.*"  # Date exported line
    # Skip lines until we find the field names line
    # Works for both files with headers (skips filename/date) and without headers (finds field line directly)
    skip_lines: 10  # Max lines to check
    skip_regex:
      - regex: "MAP"

    # Field transformations for Zeitronix overlay compatibility
    field_transformations:
      prepend: "Zeitronix "     # Add Zeitronix prefix with space to field names for overlay compatibility
      exclude_fields: ["RPM", "TIME"]  # Don't prefix RPM and TIME fields

    aliases:
      - [".*RPM$", "RPM"]
      - [".*Boost$", "Boost"]
      - [".*TPS$", "ThrottlePlateAngle"]
      - [".*Lambda$", "Lambda"]

  WINLOG:
    field_signatures:
      - regex: "WinLog.*"  # First line contains "WinLog"
    # Skip first line (WinLog version info) to get to field headers
    skip_lines: 1

    aliases:
      - ["logtime", "TIME"]
