---
name: Release Build

on:
  push:
    tags: [ 'v*' ]

jobs:
  build-macos:
    uses: ./.github/workflows/build-platform.yml
    with:
      platform: macos
      build-target: dmg
      artifact-paths: |
        build/*-MacOS.zip
        build/*.dmg
      use-cache: true

  build-linux:
    uses: ./.github/workflows/build-platform.yml
    with:
      platform: linux
      build-target: installers
      artifact-paths: |
        build/*.tar.gz
        build/*-setup.exe
        ECUxPlot-*.jar
        mapdump.jar
      use-cache: true

  create-release:
    runs-on: ubuntu-latest
    needs: [build-macos, build-linux]
    steps:
    - name: Download all artifacts
      uses: actions/download-artifact@v5

    - name: Create release
      uses: softprops/action-gh-release@v2
      with:
        files: |
          macos-builds/*.dmg
          linux-windows-builds/build/*
          linux-windows-builds/*.jar
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
